version: 2
jobs:
   build:
     docker:
       - image: circleci/python:3.6.1
     steps:
       - checkout

       - run:
           command: |
             sudo apt-get update && sudo apt-get install -y awscli
             export PATH="$HOME/.local/bin:$PATH"
             pip install --user pipenv
             python3 -m venv venv
             . venv/bin/activate
             pipenv install

       - run:
           command: |
             . venv/bin/activate
             make zip
             aws s3 sync dist/ s3://secureletter-app.us-west-2.amazonaws.com

       - store_artifacts:
           path: dist/secureletter.zip
           destination: dist
